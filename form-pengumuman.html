<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content>
        <meta name="author"
            content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
        <meta name="generator" content="Hugo 0.84.0">
        <title>Form Pengumuman - Perpustakaan</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap"
            rel="stylesheet">
        <style>
        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: "Quicksand", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
        }
    </style>
    </head>

    <body>
        <main class="d-flex">
            <div class="sidebar d-flex flex-column flex-shrink-0 p-3 bg-light"
                style="width: 280px;">
                <a href="/"
                    class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
                    <img src="assets/udb.png" class="bi me-2" height="32">
                    <span class="fs-4">Perpustakaan</span>
                </a>
                <hr>
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a href="koleksi-buku.html" class="nav-link link-dark">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?id=85767&format=png&color=000000"
                                alt>Koleksi Buku
                        </a>
                    </li>
                    <li>
                        <a href="peminjaman.html" class="nav-link link-dark">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?size=100&id=bDrb5MdYaEje&format=png&color=000000"
                                alt>Peminjaman
                        </a>
                    </li>
                    <li>
                        <a href="pengumuman.html" class="nav-link active"
                            aria-current="page">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?size=100&id=77&format=png&color=ffffff"
                                alt>Pengumuman
                        </a>
                    </li>
                    <a href="anggota.html" class="nav-link link-dark">
                         <img class="bi me-2" width="16" height="16"
                            src="https://img.icons8.com/?size=100&id=12107&format=png&color=000000" alt>Manajemen Anggota
                    </a>
                </li>
                </ul>
                <hr>
                <div class="dropdown">
                    <a href="#"
                        class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle"
                        id="dropdownUser2" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <img
                            src="https://img.icons8.com/?size=100&id=23400&format=png&color=000000"
                            alt width="32" height="32"
                            class="rounded-circle me-2">
                        <strong>Admin Perpustakaan 1</strong>
                    </a>
                    <ul class="dropdown-menu text-small shadow"
                        aria-labelledby="dropdownUser2">
                        <li>
                            <a class="dropdown-item"
                                href="profile.html">Profile</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item" href="index.html">Sign
                                out</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="content p-4 flex-grow-1"
                style="background-image: url(assets/logo-trans.png);margin: 0;height: 100vh;background-size: cover;background-position: center;background-size: 450px 550px;background-repeat: no-repeat;">
                <h2 class="mb-4" id="form-title-announcement">Form Pengumuman</h2>
                <div class="container py-5">
                    <form id="announcementForm">
                        <input type="hidden" id="announcementId">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label for="judulPengumuman" class="form-label">Judul Pengumuman</label>
                                <input type="text" class="form-control" id="judulPengumuman" placeholder="Masukkan judul pengumuman" required>
                            </div>
                            <div class="col-md-6">
                                <label for="tanggalPengumuman" class="form-label">Tanggal</label>
                                <input type="date" class="form-control" id="tanggalPengumuman" required>
                            </div>
                            <div class="col-md-12">
                                <label for="isiPengumuman" class="form-label">Isi Pengumuman</label>
                                <textarea class="form-control" id="isiPengumuman" rows="5" placeholder="Masukkan isi pengumuman" required></textarea>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button type="submit" class="btn btn-warning" id="submitAnnouncementButton">Simpan</button>
                            <a href="pengumuman.html"
                                class="btn btn-primary">Kembali</a>
                        </div>
                    </form>
                </div>
            </div>
        </main>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <script>
        /* global bootstrap: false */
        (function () {
            'use strict'
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl)
            })
        })();

        document.addEventListener('DOMContentLoaded', () => {
            const announcementForm = document.getElementById('announcementForm');
            const formTitle = document.getElementById('form-title-announcement');
            const submitButton = document.getElementById('submitAnnouncementButton');
            const announcementIdField = document.getElementById('announcementId');
            const judulField = document.getElementById('judulPengumuman');
            const tanggalField = document.getElementById('tanggalPengumuman');
            const isiField = document.getElementById('isiPengumuman');

            const urlParams = new URLSearchParams(window.location.search);
            const editAnnouncementId = urlParams.get('edit');

            if (editAnnouncementId) {
                formTitle.textContent = 'Edit Pengumuman';
                submitButton.textContent = 'Update';
                const announcements = JSON.parse(sessionStorage.getItem('announcements')) || [];
                const announcementToEdit = announcements.find(ann => ann.id === parseInt(editAnnouncementId));

                if (announcementToEdit) {
                    announcementIdField.value = announcementToEdit.id;
                    judulField.value = announcementToEdit.title;
                    tanggalField.value = announcementToEdit.date;
                    isiField.value = announcementToEdit.content;
                } else {
                    alert('Pengumuman tidak ditemukan!');
                    window.location.href = 'pengumuman.html';
                }
            } else {
                // Set tanggal default untuk form baru
                tanggalField.value = new Date().toISOString().split('T')[0];
            }


            announcementForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const announcementData = {
                    id: announcementIdField.value ? parseInt(announcementIdField.value) : (parseInt(sessionStorage.getItem('nextAnnouncementId') || '1')),
                    title: judulField.value,
                    date: tanggalField.value,
                    content: isiField.value
                };

                let announcements = JSON.parse(sessionStorage.getItem('announcements')) || [];

                if (editAnnouncementId) { // Mode Edit
                    const annIndex = announcements.findIndex(ann => ann.id === announcementData.id);
                    if (annIndex > -1) {
                        announcements[annIndex] = announcementData;
                    }
                } else { // Mode Tambah
                    announcements.push(announcementData);
                    sessionStorage.setItem('nextAnnouncementId', (announcementData.id + 1).toString());
                }

                sessionStorage.setItem('announcements', JSON.stringify(announcements));
                alert(editAnnouncementId ? 'Pengumuman berhasil diupdate!' : 'Pengumuman baru berhasil ditambahkan!');
                window.location.href = 'pengumuman.html';
            });
        });
    </script>
    </body>
</html>