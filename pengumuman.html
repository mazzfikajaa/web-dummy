<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Daftar Pengumuman Perpustakaan">
        <meta name="author"
            content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
        <meta name="generator" content="Hugo 0.84.0">
        <title>Pengumuman - Perpustakaan</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap"
            rel="stylesheet">
        <style>
        body {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            font-family: "Quicksand", sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-style: normal;
        }
        .card-text-short {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Jumlah baris yang ingin ditampilkan untuk preview */
            line-clamp: 3;
            -webkit-box-orient: vertical;
            /* max-height: 4.5em; Sesuaikan jika perlu, atau biarkan -webkit-line-clamp yang mengatur */
            line-height: 1.5em; /* Sesuaikan dengan line-height teks Anda */
        }
        .full-content-container {
            display: none; /* Defaultnya tersembunyi */
        }
        .card.is-expanded .card-text-short {
            display: none;
        }
        .card.is-expanded .full-content-container {
            display: block;
        }
        /* Memastikan card bisa menyesuaikan tinggi saat konten penuh ditampilkan */
        .card.is-expanded {
            height: auto !important; 
        }
    </style>
    </head>

    <body>
        <main class="d-flex">
            <div class="sidebar d-flex flex-column flex-shrink-0 p-3 bg-light"
                style="width: 280px;">
                <a href="index.html" 
                    class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
                    <img src="assets/udb.png" class="bi me-2" height="32">
                    <span class="fs-4">Perpustakaan</span>
                </a>
                <hr>
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a href="koleksi-buku.html" class="nav-link link-dark">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?id=85767&format=png&color=000000"
                                alt>Koleksi Buku
                        </a>
                    </li>
                    <li>
                        <a href="peminjaman.html" class="nav-link link-dark">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?size=100&id=bDrb5MdYaEje&format=png&color=000000"
                                alt>Peminjaman
                        </a>
                    </li>
                    <li>
                        <a href="pengumuman.html" class="nav-link active" 
                            aria-current="page">
                            <img class="bi me-2" width="16" height="16"
                                src="https://img.icons8.com/?size=100&id=77&format=png&color=ffffff"
                                alt>Pengumuman
                        </a>
                    </li>
                    <a href="anggota.html" class="nav-link link-dark">
                         <img class="bi me-2" width="16" height="16"
                            src="https://img.icons8.com/?size=100&id=12107&format=png&color=000000" alt>Manajemen Anggota
                    </a>
                </li>
                </ul>
                <hr>
                <div class="dropdown">
                    <a href="#"
                        class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle"
                        id="dropdownUser2" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <img
                            src="https://img.icons8.com/?size=100&id=23400&format=png&color=000000"
                            alt="User" width="32" height="32"
                            class="rounded-circle me-2">
                        <strong id="sidebarAdminName">Admin</strong>
                    </a>
                    <ul class="dropdown-menu text-small shadow"
                        aria-labelledby="dropdownUser2">
                        <li>
                            <a class="dropdown-item"
                                href="profile.html">Profile</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item" href="index.html">Sign
                                out</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="content p-4 flex-grow-1"
                style="background-image: url(assets/logo-trans.png);margin: 0;height: 100vh;background-size: cover;background-position: center;background-size: 450px 550px;background-repeat: no-repeat;">
                <h2 class="mb-4">Daftar Pengumuman</h2>
                <div class="mb-3">
                    <a href="form-pengumuman.html" class="btn btn-primary">+
                        Tambah Pengumuman</a>
                </div>
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="announcement-cards-container">
                    </div>
            </div>
        </main>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <script>
        /* global bootstrap: false */
        (function () {
            'use strict'
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl)
            })
        })();

        let allAnnouncementsData = []; // Untuk menyimpan semua data pengumuman

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) {
                return text;
            }
            // Cari spasi terakhir sebelum maxLength agar tidak memotong kata
            let lastSpace = text.substring(0, maxLength).lastIndexOf(' ');
            if (lastSpace === -1) lastSpace = maxLength; // Jika tidak ada spasi, potong di maxLength
            return text.substring(0, lastSpace) + "...";
        }

        function loadAnnouncements() {
            allAnnouncementsData = JSON.parse(sessionStorage.getItem('announcements')) || [];
            const container = document.getElementById('announcement-cards-container');
            container.innerHTML = ''; // Kosongkan kontainer

            if (allAnnouncementsData.length === 0) {
                container.innerHTML = '<p class="col-12 text-center">Tidak ada pengumuman.</p>';
                return;
            }

            allAnnouncementsData.forEach(announcement => {
                const maxLength = 100; // Jumlah karakter maksimal untuk preview
                const shortContent = truncateText(announcement.content, maxLength);

                // Simpan konten asli yang sudah diformat dengan <br> untuk detail
                const fullContentFormatted = announcement.content.replace(/\n/g, '<br>');

                const card = `
                    <div class="col">
                        <div class="card h-100"> 
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${announcement.title}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${new Date(announcement.date).toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric'})}</h6>
                                <div class="announcement-content-area flex-grow-1">
                                    <p class="card-text card-text-short">${shortContent.replace(/\n/g, '<br>')}</p>
                                    <div class="full-content-container">
                                        <p class="card-text card-text-full">${fullContentFormatted}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-end">
                                <button class="btn btn-info btn-sm me-2 toggle-detail-btn" data-id="${announcement.id}" data-state="short">Detail</button>
                                <a href="form-pengumuman.html?edit=${announcement.id}" class="btn btn-warning btn-sm me-2">Edit</a>
                                <button class="btn btn-danger btn-sm" onclick="deleteAnnouncement(${announcement.id})">Hapus</button>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        function deleteAnnouncement(announcementId) {
            if (confirm('Apakah Anda yakin ingin menghapus pengumuman ini?')) {
                allAnnouncementsData = allAnnouncementsData.filter(ann => ann.id !== announcementId);
                sessionStorage.setItem('announcements', JSON.stringify(allAnnouncementsData));
                loadAnnouncements(); // Muat ulang kartu setelah menghapus
            }
        }
        
        function updateAdminNameSidebar() {
            const adminProfile = JSON.parse(sessionStorage.getItem('adminProfile'));
            if (adminProfile && adminProfile.name) {
                document.getElementById('sidebarAdminName').textContent = adminProfile.name;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadAnnouncements();
            updateAdminNameSidebar();

            const container = document.getElementById('announcement-cards-container');
            container.addEventListener('click', function(event) {
                const targetButton = event.target.closest('.toggle-detail-btn');
                if (targetButton) {
                    const card = targetButton.closest('.card');
                    const currentState = targetButton.dataset.state;

                    if (currentState === 'short') {
                        card.classList.add('is-expanded');
                        targetButton.textContent = 'Sembunyikan';
                        targetButton.dataset.state = 'full';
                    } else {
                        card.classList.remove('is-expanded');
                        targetButton.textContent = 'Detail';
                        targetButton.dataset.state = 'short';
                    }
                }
            });
        });
        </script>
    </body>
</html>